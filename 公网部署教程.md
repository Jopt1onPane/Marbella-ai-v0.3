# 🌐 员工管理系统公网部署完整教程

## 📋 部署方案选择

### 推荐方案：Vercel + Render（免费）
- **前端**：Vercel（免费，自动部署）
- **后端**：Render（免费，简单部署）
- **数据库**：Render PostgreSQL（免费）

### 备选方案
- **Vercel + Railway**（Railway需要付费）
- **Netlify + Render**
- **GitHub Pages + Heroku**

## 🚀 第一步：准备项目

### 1.1 重新构建前端
```bash
# 在项目根目录运行
build.bat
```

### 1.2 检查构建结果
确保 `staff-management-frontend/dist/` 目录包含：
- `index.html`
- `assets/index-*.js`
- `assets/index-*.css`

## 🌐 第二步：部署前端到 Vercel

### 2.1 注册 Vercel 账户
1. 访问 https://vercel.com
2. 使用 GitHub 账户注册
3. 完成邮箱验证

### 2.2 创建 Vercel 项目
1. 点击 "New Project"
2. 选择 "Import Git Repository"
3. 连接您的 GitHub 仓库
4. 选择 `staff-management-frontend` 目录

### 2.3 配置构建设置
```json
// vercel.json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "installCommand": "npm install",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
```

### 2.4 环境变量配置
在 Vercel 项目设置中添加：
```
VITE_API_BASE_URL=https://your-backend-url.onrender.com
```

## 🚂 第三步：部署后端到 Render

### 3.1 注册 Render 账户
1. 访问 https://render.com
2. 使用 GitHub 账户注册
3. 完成邮箱验证

### 3.2 创建 Web Service
1. 点击 "New" → "Web Service"
2. 选择 "Connect a repository"
3. 连接您的 GitHub 仓库
4. 选择 `staff-management-system` 目录

### 3.3 配置服务设置
```
Name: staff-management-backend
Environment: Python 3
Region: 选择离您最近的地区
Branch: main
Root Directory: staff-management-system
Build Command: pip install -r requirements.txt
Start Command: gunicorn src.main:app
```

### 3.4 环境变量配置
在 Render 项目设置中添加：
```
FLASK_ENV=production
FLASK_APP=src.main
JWT_SECRET_KEY=your-secret-key-here
CORS_ORIGINS=https://your-frontend-url.vercel.app
```

### 3.5 添加 PostgreSQL 数据库
1. 在 Render 中点击 "New" → "PostgreSQL"
2. 配置数据库设置
3. 复制连接字符串到环境变量：
```
DATABASE_URL=postgresql://username:password@host:port/database
```

## 🔧 第四步：修改后端配置

### 4.1 更新数据库配置
```python
# src/main.py
import os
from flask import Flask
from flask_sqlalchemy import SQLAlchemy
from flask_cors import CORS

app = Flask(__name__)

# 数据库配置
DATABASE_URL = os.getenv('DATABASE_URL', 'sqlite:///app.db')
if DATABASE_URL.startswith('postgres://'):
    DATABASE_URL = DATABASE_URL.replace('postgres://', 'postgresql://', 1)

app.config['SQLALCHEMY_DATABASE_URI'] = DATABASE_URL
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False

# CORS 配置
CORS(app, origins=os.getenv('CORS_ORIGINS', '*').split(','))

# JWT 配置
app.config['JWT_SECRET_KEY'] = os.getenv('JWT_SECRET_KEY', 'your-secret-key')
```

### 4.2 创建 requirements.txt
```txt
Flask==3.1.1
Flask-SQLAlchemy==3.1.1
Flask-JWT-Extended==4.7.1
Flask-CORS==6.0.0
psycopg2-binary==2.9.9
gunicorn==21.2.0
```

### 4.3 创建 Procfile
```
web: gunicorn src.main:app
```

## 🔄 第五步：更新前端 API 配置

### 5.1 修改 API 基础 URL
```javascript
// src/lib/api.js
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:5000';

const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});
```

### 5.2 环境变量文件
```env
# .env.production
VITE_API_BASE_URL=https://your-backend-url.onrender.com
```

## 🚀 第六步：自动化部署

### 6.1 GitHub Actions 配置
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  deploy-frontend:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: '18'
    - run: cd staff-management-frontend && npm install
    - run: cd staff-management-frontend && npm run build
    - uses: amondnet/vercel-action@v25
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID }}
        vercel-project-id: ${{ secrets.PROJECT_ID }}
        working-directory: ./staff-management-frontend
```

## 🔐 第七步：安全配置

### 7.1 设置强密码
```python
# 生成强密钥
import secrets
print(secrets.token_hex(32))
```

### 7.2 配置 HTTPS
- Vercel 自动提供 HTTPS
- Render 自动提供 HTTPS
- 确保所有 API 调用使用 HTTPS

### 7.3 数据库安全
- 使用强密码
- 限制数据库访问 IP
- 定期备份数据

## 📊 第八步：监控和维护

### 8.1 性能监控
- Vercel Analytics
- Render Metrics
- 错误日志监控

### 8.2 定期维护
- 更新依赖包
- 数据库备份
- 安全补丁

## 🎯 部署检查清单

### 前端检查
- [ ] 构建成功
- [ ] Vercel 部署成功
- [ ] 环境变量配置正确
- [ ] HTTPS 证书有效
- [ ] 页面加载正常

### 后端检查
- [ ] Render 部署成功
- [ ] 数据库连接正常
- [ ] API 接口响应正常
- [ ] CORS 配置正确
- [ ] 环境变量设置正确

### 集成检查
- [ ] 前后端通信正常
- [ ] 用户登录功能正常
- [ ] 任务管理功能正常
- [ ] 文件上传功能正常
- [ ] 移动端适配正常

## 🆘 常见问题解决

### 构建失败
```bash
# 清理缓存
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### 部署失败
- 检查环境变量
- 查看部署日志
- 确认文件路径正确

### 数据库连接失败
- 检查 DATABASE_URL 格式
- 确认数据库服务状态
- 验证网络连接

## 📞 技术支持

### 官方文档
- Vercel: https://vercel.com/docs
- Render: https://render.com/docs
- Flask: https://flask.palletsprojects.com

### 社区支持
- GitHub Issues
- Stack Overflow
- Discord 社区

## 🎉 部署完成

部署成功后，您将获得：
- 🌐 公网可访问的网址
- 🔒 自动 HTTPS 证书
- 📱 移动端适配
- ⚡ 全球 CDN 加速
- 🔄 自动部署更新

**恭喜！您的员工管理系统已成功部署到公网！** 